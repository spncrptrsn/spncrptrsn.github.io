Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_QuestDef_State("ARX_BonesDontLie","QuestReceived",1);
DB_QuestDef_State("ARX_BonesDontLie","FoundOrb",1);
DB_QuestDef_State("ARX_BonesDontLie","FoundBones",1);
DB_QuestDef_State("ARX_BonesDontLie","FoundRobes",1);
DB_QuestDef_State("ARX_BonesDontLie","BoatHint",1);
DB_QuestDef_State("ARX_BonesDontLie","ArmKnowledge",1);
DB_QuestDef_State("ARX_BonesDontLie","BrothKnowledge",1);
DB_QuestDef_State("ARX_BonesDontLie","LegKnowledge",1);
DB_QuestDef_State("ARX_BonesDontLie","HeadKnowledge",1);
DB_DialogMoneyTransfer(1,"BDL_Elf_Camp",615); //BrothRecipe //GEN_CheckMagicPocketGold_6057ad05-9492-4630-9f0a-be548b134c54
DB_DialogMoneyTransfer(2,"BDL_Elf_Camp",827); //BrothCost //GEN_CheckMagicPocketGold_2_463b0f43-5410-412d-aba3-875cf81c38ca
DB_DialogMoneyTransfer(3,"BDL_Elf_Camp",862); //LimbCost //GEN_CheckMagicPocketGold_3_01f129ea-b4dc-44b6-8154-9a948f876a82
DB_DialogMoneyTransfer(4,"BDL_Elf_Camp",987); //HeadCost //GEN_CheckMagicPocketGold_4_5dac5eea-faeb-459c-b675-46c51519b784
DB_Dialogs(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,"BDL_Elf_Camp");
DB_TriggerSendsSpotEvents(TRIGGERGUID_S_ARX_Outskirts_EscapingPilgrims_PolyTrig_265a623f-616f-4ca7-ae64-188cfc10a11a);
DB_TriggerSendsSpotEvents(TRIGGERGUID_S_BDL_Bridge_PolyTrig_94b38480-753d-45de-9879-1a90d0fa3cf5);
DB_DoNotFace(CHARACTERGUID_BDL_Magister_Boat_a4e9c4f6-6072-4b3a-8e78-ba9055c99f8e);
KBSECTION
//===========================================================//
//                    Testing Helpers                       *//
//===========================================================//

IF 
ItemEquipped(_item,_char)
THEN
CharacterAddSkill(_char,"Shout_SpiritVision");
CharacterAddSkill(_char,"Shout_InspireStart");
CharacterAddSkill(_char,"Target_SourceVampirism");
CharacterAddSkill(_char,"Teleportation_FreeFall");
CharacterAddTalent(_char,"AnimalEmpathy");
CharacterAddAbilityPoint(_char,10);
CharacterAddGold(_char,10000);

IF 
SkillCast(_char,"Shout_InspireStart",_element)
AND
GetPosition(S_ARX_Outskirts_EscapingPilgrims_PolyTrig_265a623f-616f-4ca7-ae64-188cfc10a11a,_X,_Y,_Z)
THEN
TeleportToPosition(_char,_X,_Y,_Z,"",0);

//===========================================================//
//                      Has Item Flags                      *//
//===========================================================//

IF
ItemAddedToCharacter(ITEMGUID_BDL_Source_Orb_000_c85c8105-48d6-4fa1-8b77-ee4cc4ea4fa1,_Player)
THEN
ProcSetMagicPocketsOwnershipFlag(_Player,"BDL_Player_FoundOrb");

IF
ItemAddedToCharacter(ITEMGUID_S_BDL_BodyPart_Arm_3b34ca6b-e164-487e-8875-de3ce79567c0,_Player)
THEN
ProcSetMagicPocketsOwnershipFlag(_Player,"BDL_Player_HasArm");
CharacterUseSkill(CHARACTERGUID_BDL_Dummy_Boat_6a793cd0-281a-4618-b314-66329e38b8d4,"Shout_BDLSplode",CHARACTERGUID_BDL_Dummy_Boat_6a793cd0-281a-4618-b314-66329e38b8d4,0,1);
ObjectSetFlag(_Player,"BDL_Player_DisturbedCorpse");

IF
ItemRemovedFromCharacter(ITEMGUID_S_BDL_BodyPart_Arm_3b34ca6b-e164-487e-8875-de3ce79567c0,_Player)
THEN
ProcClearMagicPocketsOwnershipFlag(_Player,"BDL_Player_HasArm");

IF
ItemAddedToCharacter(ITEMGUID_S_BDL_BodyPart_Head_023ff3be-eb4a-443c-b6e8-514991c6e1a7,_Player)
THEN
ProcSetMagicPocketsOwnershipFlag(_Player,"BDL_Player_HasHead");
CharacterUseSkill(CHARACTERGUID_BDL_Dummy_Bridge_d0b08618-c472-4694-a6e2-2a6fbf98e52a,"Shout_BDLSplode",CHARACTERGUID_BDL_Dummy_Bridge_d0b08618-c472-4694-a6e2-2a6fbf98e52a,0,1);

IF
ItemRemovedFromCharacter(ITEMGUID_S_BDL_BodyPart_Head_023ff3be-eb4a-443c-b6e8-514991c6e1a7,_Player)
THEN
ProcClearMagicPocketsOwnershipFlag(_Player,"BDL_Player_HasHead");

IF
ItemAddedToCharacter(ITEMGUID_S_BDL_BodyPart_Leg_f0ea0db9-5d55-4954-a043-d1745715f267,_Player)
THEN
ProcSetMagicPocketsOwnershipFlag(_Player,"BDL_Player_HasLeg");
CharacterUseSkill(CHARACTERGUID_BDL_Dummy_Ruins_fcd29b5f-725b-4907-80c1-59de78042924,"Shout_BDLSplode",CHARACTERGUID_BDL_Dummy_Ruins_fcd29b5f-725b-4907-80c1-59de78042924,0,1);

IF
ItemRemovedFromCharacter(ITEMGUID_S_BDL_BodyPart_Leg_f0ea0db9-5d55-4954-a043-d1745715f267,_Player)
THEN
ProcClearMagicPocketsOwnershipFlag(_Player,"BDL_Player_HasLeg");

IF
ItemAddedToCharacter(ITEMGUID_S_BDL_BodyPart_Broth_000_7890edbc-e66d-4ae9-b3f8-77d924178da8,_Player)
THEN
ProcSetMagicPocketsOwnershipFlag(_Player,"BDL_Player_HasBroth");

IF
ItemRemovedFromCharacter(ITEMGUID_S_BDL_BodyPart_Broth_000_7890edbc-e66d-4ae9-b3f8-77d924178da8,_Player)
THEN
ProcClearMagicPocketsOwnershipFlag(_Player,"BDL_Player_HasBroth");

//===========================================================//
//                  Item Transger Flags                     *//
//===========================================================//

IF
ObjectFlagSet("BDL_Player_RemoveArm",_Player,_)
AND
QryTakeItemFromMagicPockets(_Player,ITEMGUID_S_BDL_BodyPart_Arm_3b34ca6b-e164-487e-8875-de3ce79567c0,CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20)
THEN
ProcSetMagicPocketsOwnershipFlag(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,"BDL_Elf_HasArm");

IF
ObjectFlagSet("BDL_Player_RemoveHead",_Player,_)
AND
QryTakeItemFromMagicPockets(_Player,ITEMGUID_S_BDL_BodyPart_Head_023ff3be-eb4a-443c-b6e8-514991c6e1a7,CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20)
THEN
ProcSetMagicPocketsOwnershipFlag(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,"BDL_Elf_HasHead");

IF
ObjectFlagSet("BDL_Player_RemoveBroth",_Player,_)
AND
QryTakeItemFromMagicPockets(_Player,ITEMGUID_S_BDL_BodyPart_Broth_000_7890edbc-e66d-4ae9-b3f8-77d924178da8,CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20)
THEN
ProcSetMagicPocketsOwnershipFlag(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,"BDL_Elf_HasBroth");

IF
ObjectFlagSet("BDL_Player_RemoveLeg",_Player,_)
AND
QryTakeItemFromMagicPockets(_Player,ITEMGUID_S_BDL_BodyPart_Leg_f0ea0db9-5d55-4954-a043-d1745715f267,CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20)
THEN
ProcSetMagicPocketsOwnershipFlag(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,"BDL_Elf_HasLeg");

IF 
ObjectFlagSet("BDL_Player_GetRecipe",_player,_)
THEN
ItemTemplateAddTo("ITEMGUID_CON_Drink_Mug_A_Water_d43fe28f-c494-4ffd-855c-34fab202ebc6",_Player,1);
ItemTemplateAddTo("ITEMGUID_LAB_MortarPestle_A_e834444d-cdb9-42ad-8fd4-71bb22126f72",_Player,1);
CharacterUnlockRecipe((CHARACTERGUID)_player,"BDL_Skull_Human_LAB_MortarPestle_A",1);
CharacterUnlockRecipe((CHARACTERGUID)_player,"BDL_Bone_Dust_CON_Drink_Mug_Water_A",1);

//===========================================================//
//                  Eating Convo Flags                      *//
//===========================================================//

IF
ObjectFlagSet("BDL_Elf_ArmShare",CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,_)
AND 
DB_IsPlayer(_Player)
THEN
Proc_StartDialog(1,"BDL_Elf_Camp",CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,_Player); 

IF
ObjectFlagSet("BDL_Elf_HeadShare",CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,_)
AND 
DB_IsPlayer(_Player)
THEN
Proc_StartDialog(1,"BDL_Elf_Camp",CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,_Player); 

IF
ObjectFlagSet("BDL_Elf_BrothShare",CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,_)
AND 
DB_IsPlayer(_Player)
THEN
Proc_StartDialog(1,"BDL_Elf_Camp",CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,_Player); 

IF
ObjectFlagSet("BDL_Elf_LegShare",CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,_)
AND 
DB_IsPlayer(_Player)
THEN
Proc_StartDialog(1,"BDL_Elf_Camp",CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,_Player); 

//===========================================================//
//                    Moving Characters                     *//
//===========================================================//

IF
DB_Event_CharacterAppearedInSpotTrigger(_Player,S_ARX_Outskirts_EscapingPilgrims_PolyTrig_265a623f-616f-4ca7-ae64-188cfc10a11a)
AND
DB_IsPlayer(_Player)
AND
QRY_SpeakerIsAvailable(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20)
THEN
ProcCharacterMoveTo(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,_Player,1,"BDL_Elf_Camp");

IF
StoryEvent(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,"BDL_Elf_Camp")
AND
DB_IsPlayer(_Player)
AND
ObjectGetFlag(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,"BDL_Elf_Hailed",0)
THEN
ProcCharacterMoveToAndTalk(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,_Player,"BDL_Elf_Camp",0,"BDL_Elf_Camp",1,10.0,1,0);
ObjectSetFlag(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,"BDL_Elf_Hailed");

IF
DialogEnded("BDL_Elf_Camp",_Inst)
AND
ObjectGetFlag(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,"BDL_Elf_MovingOn",1)
THEN
CharacterMoveTo(CHARACTERGUID_BDL_Elf_Camp_1c5b730b-6b11-43ff-92be-9be2c941bd20,TRIGGERGUID_BDL_PointTrigger_Camp_94b0251c-c01d-4735-87ad-05cfb0f5d79b,1,"",0);

IF
DB_Event_CharacterAppearedInSpotTrigger(_Player,TRIGGERGUID_S_BDL_Bridge_PolyTrig_94b38480-753d-45de-9879-1a90d0fa3cf5)
AND
DB_IsPlayer(_Player)
AND
QRY_SpeakerIsAvailable(CHARACTERGUID_BDL_Magister_Farmer_95fa84e4-c7b2-4012-8857-882c2958338c)
THEN
ProcCharacterMoveTo(CHARACTERGUID_BDL_Magister_Farmer_95fa84e4-c7b2-4012-8857-882c2958338c,_Player,1,"BDL_Magister_Farmer");

IF
StoryEvent(CHARACTERGUID_BDL_Magister_Farmer_95fa84e4-c7b2-4012-8857-882c2958338c,"BDL_Magister_Farmer")
AND
DB_IsPlayer(_Player)
AND
ObjectGetFlag(CHARACTERGUID_BDL_Magister_Farmer_95fa84e4-c7b2-4012-8857-882c2958338c,"BDL_Magister_Hailed",0)
THEN
ProcCharacterMoveToAndTalk(CHARACTERGUID_BDL_Magister_Farmer_95fa84e4-c7b2-4012-8857-882c2958338c,_Player,"BDL_Magister_Farmer",0,"BDL_Magister_Farmer",1,10.0,1,0);
ObjectSetFlag(CHARACTERGUID_BDL_Magister_Farmer_95fa84e4-c7b2-4012-8857-882c2958338c,"BDL_Magister_Hailed");

IF
DialogEnded("BDL_Magister_Farmer",_Inst)
AND
ObjectGetFlag(CHARACTERGUID_BDL_Magister_Farmer_95fa84e4-c7b2-4012-8857-882c2958338c,"BDL_Magister_MovingOn",1)
THEN
CharacterMoveTo(CHARACTERGUID_BDL_Magister_Farmer_95fa84e4-c7b2-4012-8857-882c2958338c,TRIGGERGUID_S_BDL_BoxTrigger_ChickenWander_c1826067-7b37-4ec8-b84b-9d3093a1a464,1,"",0);

//===========================================================//
//                    Found Item Flags                      *//
//===========================================================//

IF 
ItemAddedToCharacter(ITEMGUID_BDL_Source_Orb_000_c85c8105-48d6-4fa1-8b77-ee4cc4ea4fa1,(CHARACTERGUID)_Player)
AND 
DB_IsPlayer(_Player)
THEN
UserSetFlag(_Player,"QuestUpdate_ARX_BonesDontLie_FoundOrb");

IF 
ItemAddedToCharacter(ITEMGUID_BDL_Source_Orb_001_75eb4e0c-ce5a-4772-a66d-bbd22b03d8c4,(CHARACTERGUID)_Player)
AND 
DB_IsPlayer(_Player)
THEN
UserSetFlag(_Player,"QuestUpdate_ARX_BonesDontLie_FoundOrb");

IF 
CharacterUsedItem((CHARACTERGUID)_Player,ITEMGUID_S_BDL_BodyPart_ARM_3b34ca6b-e164-487e-8875-de3ce79567c0)
AND 
DB_IsPlayer(_Player)
THEN
UserSetFlag(_Player,"QuestUpdate_ARX_BonesDontLie_ArmKnowledge");

IF 
ItemOpened(ITEMGUID_BDL_Human_Bones_Pile_f7b0111c-98b2-4343-bb76-87b55dcbca62)
AND 
DB_IsPlayer(_Player)
THEN
UserSetFlag(_Player,"QuestUpdate_ARX_BonesDontLie_FoundBones");

//===========================================================//
//                      Turn Mid Convo                      *//
//===========================================================//

IF 
ObjectFlagSet("BDL_NPC_FaceNow",CHARACTERGUID_BDL_Magister_Boat_a4e9c4f6-6072-4b3a-8e78-ba9055c99f8e,_ID)
AND
DialogGetInvolvedPlayer(_ID,1,_Player)
THEN
CharacterLookAt(CHARACTERGUID_BDL_Magister_Boat_a4e9c4f6-6072-4b3a-8e78-ba9055c99f8e,_Player);

IF
DialogStarted("BDL_Magister_Boat",_ID)
AND
DialogGetInvolvedPlayer(_ID,1,_Player)
AND
ObjectGetFlag(CHARACTERGUID_BDL_Magister_Boat_a4e9c4f6-6072-4b3a-8e78-ba9055c99f8e,"BDL_NPC_FaceNow",1)
THEN
CharacterLookAt(CHARACTERGUID_BDL_Magister_Boat_a4e9c4f6-6072-4b3a-8e78-ba9055c99f8e,_Player);

//==============================================================//
//                    Teleporting Dummies                      *//
//==============================================================//

IF
CharacterTeleported(CHARACTERGUID_BDL_Magister_Boat_Body_7f2fd834-9251-4f9c-9258-0bf0aacf3d67,_Caster,_A,_B,_C,_X,_Y,_Z,_Skill)
THEN
TeleportToPosition(CHARACTERGUID_BDL_Dummy_Boat_6a793cd0-281a-4618-b314-66329e38b8d4,_X,_Y,_Z,"",0);

IF
CharacterTeleported(CHARACTERGUID_ARX_Bridge_DeadMagister_008_45bcd6c5-8d67-4848-9a81-417c88dbf3ef,_Caster,_A,_B,_C,_X,_Y,_Z,_Skill)
THEN
TeleportToPosition(CHARACTERGUID_BDL_Dummy_Bridge_d0b08618-c472-4694-a6e2-2a6fbf98e52a,_X,_Y,_Z,"",0);

IF
CharacterTeleported(CHARACTERGUID_BDL_Farmer_Ruins_Body_f068c563-31ec-4f7e-b60d-aacbd5a70d5a,_Caster,_A,_B,_C,_X,_Y,_Z,_Skill)
THEN
TeleportToPosition(CHARACTERGUID_BDL_Dummy_Ruins_fcd29b5f-725b-4907-80c1-59de78042924,_X,_Y,_Z,"",0);
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ARX"
